<dom-module id="my-login">
  <style>
    :host {
      display: block;
    }
    .input-container {
      width: 100%;
      margin: 20px;
    }
    .inputs {
      --paper-input-container-input-color: var(--dark-primary-color);
    }
    .btn-login {
      margin-top: 15px;
      margin-right: 0;
      background: var(--default-primary-color);
      color: var(--text-primary-color);
      float: right;
    }
    paper-material {
      width: 340px;
    }
    paper-toolbar {
      width: 100%;
    }
  </style>
  <template>
    <paper-material elevation="3">
      <paper-toolbar>
        <h1 class="paper-font-display1"><span>Login</span></h1>
      </paper-toolbar>
    </paper-material>
    <div class="input-container">
      <paper-input
        class="inputs"
        id="txtEmailaddress"
        label="Emailaddress"
        type="text"
        value="{{emailAddress::input}}">
      </paper-input>
      <paper-input
        class="inputs"
        id="txtPassword"
        label="Password"
        type="password"
        value="{{password::input}}">
      </paper-input>
      <paper-button
        class="btn-login"
        on-click="submitLogin">Login
      </paper-button>
    </div>
  </template>
</dom-module>

<script>
  (function() {
    Polymer({
      is: 'my-login',

      properties: {
        emailAddress: {
          type: String,
          value: '',
          notify: true
        },
        password: {
          type: String,
          value: '',
          notify: true
        }
      },

      _clearInputs: function(clearBoth) {
        if (clearBoth) {
          this.$.txtEmailaddress.value = '';
        }
        this.$.txtPassword.value = '';
      },

      _authWithPassword: function(userObj) {
        return new Promise(function(resolve, reject) {
          var rootRef = new Firebase('https://yeah-url-extension.firebaseio.com/');
          rootRef.authWithPassword(userObj, function onAuth(err, user) {
            if (err) reject(err);
            if (user) resolve(user);
          });
        });
      },

      submitLogin: function() {
        var emailAddress = this.$.txtEmailaddress.value;
        var password = this.$.txtPassword.value;
        var that = this;

        var user = {
          'email': emailAddress,
          'password': password
        };

        this._authWithPassword(user)
          .then(function(user) {
            that._clearInputs(true);
            that.fire('login-successful', user);
          })
          .catch(function(err) {
            that._clearInputs(false);
            that.fire('login-failed', err);
          });
      }
    });
  })();
</script>
